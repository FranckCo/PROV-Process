@prefix ex-act: <http://example.org/linkage/activity/> .
@prefix ex: <http://example.org/linkage/> .
@prefix ex-prod: <http://example.org/linkage/product/> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dqm: <http://purl.org/dqm-vocabulary/v1/dqm#> .

# Candidate pairs to linkage keys

# Fully defined in fragment 3, repeated here for completeness
ex-prod:candidatePairs a prov:Entity ;
        rdfs:label "Candidate pairs (in blocks)"@en .

ex-prod:comparisonOutcomes a prov:Entity ;
        rdfs:label "Comparison outcomes"@en ;
        prov:wasGeneratedBy ex-act:compareRecords;
        prov:qualifiedGeneration [
             a prov:Generation ;
             prov:activity ex-act:compareRecords ;
             rdfs:comment " The outcomes of the comparisons are generated by the comparison of the records."@en;
        ] .

ex-prod:linkageKeys a prov:Entity ;
        rdfs:label "Linkage keys"@en ;
        prov:wasDerivedFrom ex-prod:candidatePairs ;
        prov:qualifiedDerivation [
             a prov:Derivation ;
             prov:entity ex-prod:candidatePairs ;
             prov:hadActivity ex-act:compareRecords ;
        ] ;
        prov:qualifiedDerivation [
             a prov:Derivation ;
             prov:entity ex-prod:comparisonOutcomes ;
             prov:hadActivity ex-act:makeLinkageDecisionsDeterministic ;
             prov:hadActivity ex-act:makeLinkageDecisionsProbalistic ;
        ] .

ex-act:compareRecords a prov:Activity ;
        rdfs:label "Compare records"@en ;
        prov:used ex-prod:candidatePairs .

# Review naming (esp. name order)
ex-act:makeLinkageDecisionsDeterministic a prov:Activity ;
        rdfs:label "Make linkage decisions deterministic"@en ;
        prov:used ex-prod:comparisonOutcomes , ex-prod:logicalConditions .

ex-act:makeLinkageDecisionsProbalistic a prov:Activity ;
        rdfs:label "Make linkage decisions probabilistic"@en ;
        prov:used ex-prod:comparisonOutcomes , ex-prod:linkagePairWeights .

ex-prod:logicalConditions a prov:Entity , dqm:ConditionalRule ;
        prov:wasGeneratedBy ex-act:compareRecords ;
        rdfs:comment "These logical conditions are developed iteratively using manual reviews on samples of pairs."@en .

ex-prod:linkagePairWeights a prov:Entity , dqm:DataQualityScore ;
        prov:wasGeneratedBy ex-act:compareRecords ;
        rdfs:comment "The total weight is compared to two thresholds to make decisions as to whether the pair represents a match or non-match. Pairs with a weight between the two thresholds are resolved manually."@en .